<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Mountain Ranges Quiz</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #1e3a8a 0%, #71bddb 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .quiz-container { 
            width: 80%; 
            max-width: 900px;
            margin: auto; 
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .question { 
            font-size: 1.3em; 
            margin-bottom: 20px; 
            color: #333;
            font-weight: bold;
        }
        .answers { list-style-type: none; padding: 0; }
        .answers li { margin: 10px 0; }
        .answers button {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .answers button:hover {
            background: #f0f8ff;
            border-color: #4CAF50;
            transform: translateY(-2px);
        }
        .results { 
            margin-top: 30px; 
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        .results-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        .results h3 { 
            color: #444; 
            margin-bottom: 20px;
            text-align: center;
        }
        
        /* Progress Bars */
        .progress-item {
            margin: 15px 0;
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.6s ease;
            position: relative;
        }
        
        /* Bloom's Taxonomy Colors */
        .bloom-recall .progress-fill { background: linear-gradient(45deg, #FF6B6B, #FF8E8E); }
        .bloom-comprehend .progress-fill { background: linear-gradient(45deg, #4ECDC4, #7FDBDA); }
        .bloom-apply .progress-fill { background: linear-gradient(45deg, #45B7D1, #74C4E8); }
        .bloom-analyze .progress-fill { background: linear-gradient(45deg, #96CEB4, #B8DAC9); }
        .bloom-evaluate .progress-fill { background: linear-gradient(45deg, #FECA57, #FED896); }
        .bloom-create .progress-fill { background: linear-gradient(45deg, #FF9FF3, #F368E0); }
        
        /* Competency Colors */
        .comp-geographic .progress-fill { background: linear-gradient(45deg, #3498db, #5dade2); }
        .comp-physical .progress-fill { background: linear-gradient(45deg, #e67e22, #f39c12); }
        .comp-human .progress-fill { background: linear-gradient(45deg, #27ae60, #2ecc71); }
        
        /* Circular Progress */
        .circular-progress {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(#4CAF50 var(--percentage, 0%), #e0e0e0 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px auto;
            position: relative;
        }
        .circular-progress::before {
            content: '';
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            position: absolute;
        }
        .circular-progress .percentage {
            position: relative;
            z-index: 1;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        /* Star Rating */
        .star-rating {
            text-align: center;
            font-size: 2em;
            margin: 10px 0;
        }
        .star {
            color: #ddd;
            transition: color 0.3s ease;
        }
        .star.filled {
            color: #ffd700;
        }
        
        .feedback { 
            font-size: 1.2em; 
            color: #2e8b57; 
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            background: #f0f8ff;
            border-left: 4px solid #2e8b57;
        }
        .incorrect-feedback { 
            color: #e74c3c; 
            background: #fff5f5;
            border-left-color: #e74c3c;
        }
        
        .next-btn {
            background: linear-gradient(45deg, #1e40af, #71bddb);
            color: white;
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.3s ease;
        }
        .next-btn:hover {
            transform: translateY(-2px);
        }
        
        .overall-progress {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .feedback-summary {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #1e40af 0%, #71bddb 100%);
            color: white;
            border-radius: 15px;
            display: none;
        }
        
        .feedback-summary h2 {
            margin-top: 0;
            text-align: center;
            font-size: 1.8em;
        }
        
        .strengths-weaknesses {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .strength-area, .improvement-area {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .strength-area h3 {
            color: #90EE90;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .improvement-area h3 {
            color: #FFB6C1;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .suggestion-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        }
        
        .suggestion-title {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .restart-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 15px 30px;
            font-size: 1.1em;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            margin: 20px 10px;
            transition: all 0.3s ease;
        }
        
        .restart-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .tooltip {
    position: relative;
    display: inline-block;
    cursor: help;
    border-bottom: 2px dotted #007bff;
    color: #007bff;
}

.tooltip .tooltip-text {
    visibility: hidden;
    width: 300px;
    background-color: #333;
    color: #fff;
    text-align: left;
    border-radius: 6px;
    padding: 12px;
    position: absolute;
    z-index: 1000;
    bottom: 125%;
    left: 50%;
    margin-left: -150px;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 14px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}
    </style>
</head>
<body>

    <div class="quiz-container">
        <div class="overall-progress">
            <h2>Overall Progress</h2>
            <div class="circular-progress" id="overall-circular">
                <div class="percentage" id="overall-percentage">0%</div>
            </div>
            <div class="star-rating" id="overall-stars">
                <span class="star">‚òÖ</span><span class="star">‚òÖ</span><span class="star">‚òÖ</span><span class="star">‚òÖ</span><span class="star">‚òÖ</span>
            </div>
            <p>Questions Answered Correctly: <span id="correct-count">0</span> / <span id="total-count">10</span></p>
        </div>

        <div id="question-container">
            <div class="question"></div> <span class="tooltip">‚ÑπÔ∏è
    <span class="tooltip-text">
        <strong>GenAI Integration Point:</strong><br>
        In an ideal implementation, these questions and corresponding learning analytics/xAPI statements would be generated automatically via AI tools. The AI agent could be trained on a question set.  
    </span>
</span> 
            <ul class="answers"></ul>
        </div>

        <div id="feedback-container" class="feedback" style="display: none;"></div> <span class="tooltip">‚ÑπÔ∏è
    <span class="tooltip-text">
        <strong>GenAI Integration Point:</strong><br>
        In a more complex question type, like a written response, our feedback agent could provide more relevant and descriptive feedback in real time.  
    </span>
</span> 

        <button class="next-btn" onclick="nextQuestion()" id="next-btn">Next Question</button>
        
        <div class="feedback-summary" id="feedback-summary">
            <h2>üéì Your Learning Journey Summary</h2>
            
            <div class="strengths-weaknesses">
                <div class="strength-area">
                    <h3>üí™ Your Strengths</h3>
                    <div id="strengths-content"></div>
                </div>
                
                <div class="improvement-area">
                    <span class="tooltip">‚ÑπÔ∏è
    <span class="tooltip-text">
        <strong>GenAI Integration Point:</strong><br>
        In context of a course, this section could also direct learners back to specific parts of the course or text to study up.  
    </span>
</span>
                    <h3>üéØ Growth Opportunities</h3>
                    <div id="improvements-content"></div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="restart-btn" onclick="restartQuiz()">Take Quiz Again</button>
                <button class="restart-btn" onclick="startFocusedPractice()">Focused Practice Quiz</button>
                <button class="restart-btn" onclick="showDetailedAnalysis()">View Detailed Analysis</button>
            </div>
        </div>

        <div class="results">
            <div class="results-section">
                <span class="tooltip">‚ÑπÔ∏è
    <span class="tooltip-text">
        <strong>xAPI Integration Point:</strong><br>
        With the use of appropriate verbs, xAPI can support this level of tracking of higher-order thinking. It doesn't need to be exclusively Bloom's, this is just an example. We'd want to look at xAPI extensions to see what exists that could align with our goals. 
    </span>
</span> 
                <h3>üß† Bloom's Taxonomy Progress</h3>               
                
                <div class="progress-item bloom-recall">
                    <div class="progress-label">
                        <span>Recall</span>
                        <span id="recall-points">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="recall-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="progress-item bloom-comprehend">
                    <div class="progress-label">
                        <span>Comprehend</span>
                        <span id="comprehend-points">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="comprehend-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="progress-item bloom-apply">
                    <div class="progress-label">
                        <span>Apply</span>
                        <span id="apply-points">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="apply-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="progress-item bloom-analyze">
                    <div class="progress-label">
                        <span>Analyze</span>
                        <span id="analyze-points">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="analyze-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="progress-item bloom-evaluate">
                    <div class="progress-label">
                        <span>Evaluate</span>
                        <span id="evaluate-points">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="evaluate-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="progress-item bloom-create">
                    <div class="progress-label">
                        <span>Create</span>
                        <span id="create-points">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="create-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="results-section">
                <h3>üèîÔ∏è Competency Areas <span class="tooltip">‚ÑπÔ∏è
    <span class="tooltip-text">
        <strong>xAPI Integration Point:</strong><br>
        Competency achievement can also be recorded with xAPI, and we could get to the level of detail where each competency has its own higher-order thinking levels of achievement within as well. This would also be a useful integration point with LDA's confidence assessment, ex: it took XX number of attempts for the learner to reach this level of competency and because of that there is X% confidence in their competency.  
    </span>
</span> </h3>
                
                <div class="progress-item comp-geographic">
                    <div class="progress-label">
                        <span>Geographic Knowledge</span>
                        <span id="competency-geographic-knowledge-location">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="geographic-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="progress-item comp-physical">
                    <div class="progress-label">
                        <span>Physical Characteristics</span>
                        <span id="competency-physical-characteristics-formation">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="physical-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="progress-item comp-human">
                    <div class="progress-label">
                        <span>Human Impact & Culture</span>
                        <span id="competency-human-impact-cultural-significance">0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="human-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            { question: "Which mountain range runs along the eastern coast of the United States?", 
              answers: ["Rocky Mountains", "Appalachian Mountains", "Cascade Range", "Sierra Nevada"], 
              correct: "Appalachian Mountains", 
              bloom: "Recall", 
              competency: "geographic-knowledge-location" },

            { question: "The Continental Divide primarily runs through which mountain range?", 
              answers: ["Appalachian Mountains", "Sierra Nevada", "Rocky Mountains", "Adirondack Mountains"], 
              correct: "Rocky Mountains", 
              bloom: "Comprehend", 
              competency: "geographic-knowledge-location" },

            { question: "What is the highest peak in the continental United States?", 
              answers: ["Mount McKinley", "Mount Whitney", "Mount Washington", "Mount Elbert"], 
              correct: "Mount Whitney", 
              bloom: "Recall", 
              competency: "physical-characteristics-formation" },

            { question: "If you were hiking in a mountain range known for its ancient, worn-down peaks and dense forests, which range would you most likely be exploring?", 
              answers: ["Rocky Mountains", "Cascade Range", "Appalachian Mountains", "Sierra Nevada"], 
              correct: "Appalachian Mountains", 
              bloom: "Apply", 
              competency: "physical-characteristics-formation" },

            { question: "Why were the Appalachian Mountains significant during early American westward expansion?", 
              answers: ["They provided easy passage to the Pacific Ocean", "They served as a natural barrier that initially limited westward movement", "They were the primary source of gold during the Gold Rush", "They had the best climate for farming"], 
              correct: "They served as a natural barrier that initially limited westward movement", 
              bloom: "Comprehend", 
              competency: "human-impact-cultural-significance" },

            { question: "Compare the geographic distribution of the Rocky Mountains and Sierra Nevada. What can you conclude about their formation and age?", 
              answers: ["Both ranges run north-south and are approximately the same age", "The Rocky Mountains cover more states and are part of a larger, more complex system", "The Sierra Nevada is older because it's closer to the ocean", "Both were formed by the same geological process at the same time"], 
              correct: "The Rocky Mountains cover more states and are part of a larger, more complex system", 
              bloom: "Analyze", 
              competency: "geographic-knowledge-location" },

            { question: "The Pacific Ring of Fire influences which US mountain range's volcanic activity?", 
              answers: ["Appalachian Mountains", "Rocky Mountains", "Ozark Mountains", "Cascade Range"], 
              correct: "Cascade Range", 
              bloom: "Analyze", 
              competency: "physical-characteristics-formation" },

            { question: "Assess the impact of the Transcontinental Railroad on mountain communities in the Sierra Nevada. Which statement best represents the most significant long-term effect?", 
              answers: ["It eliminated all Native American populations in the region", "It transformed the region from isolated mining camps to connected communities with diverse economies", "It made farming the primary economic activity in the mountains", "It had no lasting impact on local communities"], 
              correct: "It transformed the region from isolated mining camps to connected communities with diverse economies", 
              bloom: "Evaluate", 
              competency: "human-impact-cultural-significance" },

            { question: "Design a hiking route that would allow someone to experience three different types of mountain formation processes in the western United States. Which combination of ranges would best achieve this goal?", 
              answers: ["Rocky Mountains, Sierra Nevada, and Cascade Range", "Appalachian Mountains, Ozark Mountains, and Rocky Mountains", "Sierra Nevada only (different elevations)", "Cascade Range and Olympic Mountains only"], 
              correct: "Rocky Mountains, Sierra Nevada, and Cascade Range", 
              bloom: "Create", 
              competency: "physical-characteristics-formation" },

            { question: "Evaluate this statement: 'Mountain ranges in the western United States have had a greater impact on modern American culture than eastern ranges.' What evidence would best support or refute this claim?", 
              answers: ["Western ranges are taller, so they're more impressive", "Eastern ranges are older and therefore more historically significant", "Western ranges continue to influence recreation, environmental policy, and pop culture more prominently today", "The statement cannot be evaluated because cultural impact cannot be measured"], 
              correct: "Western ranges continue to influence recreation, environmental policy, and pop culture more prominently today", 
              bloom: "Evaluate", 
              competency: "human-impact-cultural-significance" }
        ];

        const questionPools = {
    'Recall': [
        { question: "Which mountain range contains Mount Rushmore?", 
          answers: ["Rocky Mountains", "Black Hills", "Appalachian Mountains", "Ozark Mountains"], 
          correct: "Black Hills", 
          bloom: "Recall", 
          competency: "geographic-knowledge-location" },
        
        { question: "What is the tallest mountain in North America?", 
          answers: ["Mount Whitney", "Mount McKinley (Denali)", "Mount Washington", "Mount Elbert"], 
          correct: "Mount McKinley (Denali)", 
          bloom: "Recall", 
          competency: "physical-characteristics-formation" }
    ],
    
    'Comprehend': [
        { question: "How do the Appalachian Mountains differ from the Rocky Mountains in terms of age and appearance?", 
          answers: ["Appalachians are younger and sharper", "Appalachians are older and more worn down", "They are the same age", "Rocky Mountains are older"], 
          correct: "Appalachians are older and more worn down", 
          bloom: "Comprehend", 
          competency: "physical-characteristics-formation" }
    ],
    
    'Apply': [
        { question: "If you wanted to find the best skiing conditions, which mountain range would you choose and why?", 
          answers: ["Appalachians - they get more snow", "Rocky Mountains - higher elevation and consistent snow", "Ozarks - they're closer to cities", "All ranges have equal skiing"], 
          correct: "Rocky Mountains - higher elevation and consistent snow", 
          bloom: "Apply", 
          competency: "physical-characteristics-formation" }
    ]
};

        let currentQuestionIndex = 0;
        let totalCorrect = 0;
        let questionsCompleted = 0;
        let isFocusedPractice = false;
        let focusedQuestions = [];

        const bloomPoints = {
            Recall: 0,
            Comprehend: 0,
            Apply: 0,
            Analyze: 0,
            Evaluate: 0,
            Create: 0
        };

        const competencyPoints = {
            "geographic-knowledge-location": 0,
            "physical-characteristics-formation": 0,
            "human-impact-cultural-significance": 0
        };

        const maxBloomPoints = {
            Recall: 2,
            Comprehend: 2,
            Apply: 1,
            Analyze: 2,
            Evaluate: 2,
            Create: 1
        };

        const maxCompetencyPoints = {
            "geographic-knowledge-location": 3,
            "physical-characteristics-formation": 4,
            "human-impact-cultural-significance": 3
        };

        function updateProgressBars() {
            // Update Bloom's bars
            Object.keys(bloomPoints).forEach(bloom => {
                const percentage = (bloomPoints[bloom] / maxBloomPoints[bloom]) * 100;
                document.getElementById(`${bloom.toLowerCase()}-bar`).style.width = `${percentage}%`;
            });

            // Update Competency bars
            const competencyMap = {
                "geographic-knowledge-location": "geographic",
                "physical-characteristics-formation": "physical", 
                "human-impact-cultural-significance": "human"
            };

            Object.keys(competencyPoints).forEach(comp => {
                const percentage = (competencyPoints[comp] / maxCompetencyPoints[comp]) * 100;
                document.getElementById(`${competencyMap[comp]}-bar`).style.width = `${percentage}%`;
            });
        }

        function updateOverallProgress() {
    // Use the ACTIVE set so Focused Practice math is correct
    const activeTotal = (isFocusedPractice ? focusedQuestions.length : questions.length) || 0;
    const overallPercentage = activeTotal ? (totalCorrect / activeTotal) * 100 : 0;

    // Update circular progress
    const circularProgress = document.getElementById('overall-circular');
    circularProgress.style.setProperty('--percentage', `${overallPercentage}%`);
    document.getElementById('overall-percentage').textContent = `${Math.round(overallPercentage)}%`;

    // Update star rating (1 star per 20%)
    const stars = Math.floor(overallPercentage / 20);
    document.querySelectorAll('.star').forEach((star, index) => {
        star.classList.toggle('filled', index < stars);
    });

    // Update counts
    document.getElementById('correct-count').textContent = totalCorrect;
    document.getElementById('total-count').textContent = activeTotal; // NEW: keep the denominator truthful
}

        function displayQuestion() {
            const currentQuestions = isFocusedPractice ? focusedQuestions : questions;
            const question = currentQuestions[currentQuestionIndex];
            const questionContainer = document.querySelector(".question");
            const answersContainer = document.querySelector(".answers");
            const feedbackContainer = document.querySelector("#feedback-container");

            questionContainer.textContent = `Question ${currentQuestionIndex + 1}: ${question.question}`;
            answersContainer.innerHTML = "";
            feedbackContainer.style.display = "none";
            
            question.answers.forEach(answer => {
                const li = document.createElement("li");
                const button = document.createElement("button");
                button.textContent = answer;
                button.onclick = () => selectAnswer(answer, question.bloom, question.competency);
                li.appendChild(button);
                answersContainer.appendChild(li);
            });
        }

        function selectAnswer(answer, bloom, competency) {
  const currentQuestions = isFocusedPractice ? focusedQuestions : questions;
  const question = currentQuestions[currentQuestionIndex];
  const feedbackContainer = document.querySelector("#feedback-container");

  feedbackContainer.style.display = "block";

  if (answer === question.correct) {
    bloomPoints[bloom]++;
    competencyPoints[competency]++;
    totalCorrect++;

    document.getElementById(`${bloom.toLowerCase()}-points`).textContent = bloomPoints[bloom];
    document.getElementById(`competency-${competency}`).textContent = competencyPoints[competency];

    feedbackContainer.textContent = "üéâ Excellent! You got it right!";
    feedbackContainer.className = "feedback";
  } else {
    feedbackContainer.textContent = "üí™ Keep trying! You're building knowledge with each attempt!";
    feedbackContainer.className = "feedback incorrect-feedback";
  }

  questionsCompleted++;
  updateProgressBars();
  updateOverallProgress();
}

        function nextQuestion() {
            currentQuestionIndex++;
            
            // Check if we've completed all questions
            const currentQuestions = isFocusedPractice ? focusedQuestions : questions;
            if (currentQuestionIndex >= currentQuestions.length) {
                displayFeedbackSummary();
                return;
            }
            
            // Update button text for last question
            if (currentQuestionIndex === currentQuestions.length - 1) {
                document.getElementById('next-btn').textContent = 'View Results';
            }
            
            displayQuestion();
        }

        function analyzePerformance() {
            const strengths = [];
            const improvements = [];
            
            // Analyze Bloom's Taxonomy performance
            const bloomAnalysis = Object.keys(bloomPoints).map(level => ({
                level,
                score: bloomPoints[level],
                maxScore: maxBloomPoints[level],
                percentage: (bloomPoints[level] / maxBloomPoints[level]) * 100
            }));
            
            // Analyze Competency performance
            const competencyAnalysis = Object.keys(competencyPoints).map(comp => ({
                competency: comp,
                score: competencyPoints[comp],
                maxScore: maxCompetencyPoints[comp],
                percentage: (competencyPoints[comp] / maxCompetencyPoints[comp]) * 100
            }));
            
            // Identify Bloom's strengths and weaknesses
            const strongBlooms = bloomAnalysis.filter(item => item.percentage >= 75);
            const weakBlooms = bloomAnalysis.filter(item => item.percentage < 50 && item.maxScore > 0);
            
            // Identify Competency strengths and weaknesses  
            const strongCompetencies = competencyAnalysis.filter(item => item.percentage >= 75);
            const weakCompetencies = competencyAnalysis.filter(item => item.percentage < 50);
            
            // Generate strength feedback
            if (strongBlooms.length > 0) {
                const bloomLabels = {
                    'Recall': 'remembering facts and basic concepts',
                    'Comprehend': 'understanding and explaining ideas', 
                    'Apply': 'applying knowledge to new situations',
                    'Analyze': 'breaking down complex information',
                    'Evaluate': 'making judgments and assessments',
                    'Create': 'producing new ideas and solutions'
                };
                
                strengths.push({
                    title: `üß† Strong Higher-Order Thinking${strongBlooms.length > 1 ? ' Skills' : ''}`,
                    content: `You excel at ${strongBlooms.map(b => bloomLabels[b.level]).join(' and ')}. This shows solid cognitive development!`
                });
            }
            
            if (strongCompetencies.length > 0) {
                const compLabels = {
                    'geographic-knowledge-location': 'geographic knowledge and spatial understanding',
                    'physical-characteristics-formation': 'understanding mountain formation and physical processes',
                    'human-impact-cultural-significance': 'connecting geography to human society and culture'
                };
                
                strengths.push({
                    title: `üèîÔ∏è Subject Matter Expertise`,
                    content: `You have strong knowledge in ${strongCompetencies.map(c => compLabels[c.competency]).join(' and ')}.`
                });
            }
            
            // Generate improvement suggestions
            if (weakBlooms.length > 0) {
                const suggestions = {
                    'Recall': 'Try creating flashcards or mind maps to strengthen your memory of key mountain facts and terminology.',
                    'Comprehend': 'Practice explaining concepts in your own words. Try teaching someone else about mountain formation processes.',
                    'Apply': 'Look for real-world examples and practice applying mountain concepts to new scenarios you encounter.',
                    'Analyze': 'Practice breaking down complex geographic relationships. Compare and contrast different mountain ranges.',
                    'Evaluate': 'Develop your critical thinking by examining multiple sources and making evidence-based judgments about geographic claims.',
                    'Create': 'Challenge yourself to design solutions or create new connections between geographic concepts.'
                };
                
                weakBlooms.forEach(bloom => {
                    improvements.push({
                        title: `üìö Strengthen ${bloom.level} Skills`,
                        content: suggestions[bloom.level]
                    });
                });
            }
            
            if (weakCompetencies.length > 0) {
                const compSuggestions = {
                    'geographic-knowledge-location': 'Review maps and practice identifying mountain ranges. Try using interactive geography tools or apps.',
                    'physical-characteristics-formation': 'Study geological processes more deeply. Watch videos about plate tectonics and mountain building.',
                    'human-impact-cultural-significance': 'Explore how mountains influence human settlement, culture, and economic activities. Read about mountain communities.'
                };
                
                weakCompetencies.forEach(comp => {
                    const labels = {
                        'geographic-knowledge-location': 'Geographic Knowledge',
                        'physical-characteristics-formation': 'Physical Processes', 
                        'human-impact-cultural-significance': 'Human-Environment Connections'
                    };
                    
                    improvements.push({
                        title: `üéØ Develop ${labels[comp.competency]}`,
                        content: compSuggestions[comp.competency]
                    });
                });
            }
            
            // Default messages if no clear patterns
            if (strengths.length === 0) {
                strengths.push({
                    title: 'üåü Building Foundation',
                    content: 'You\'re developing your understanding across multiple areas. Keep practicing to build your expertise!'
                });
            }
            
            if (improvements.length === 0) {
                improvements.push({
                    title: 'üèÜ Well Rounded Performance',
                    content: 'Great job! You\'re performing well across all areas. Challenge yourself with more advanced geographic concepts.'
                });
            }
            
            return { strengths, improvements };
        }
        
        function displayFeedbackSummary() {
            const analysis = analyzePerformance();
            const strengthsContainer = document.getElementById('strengths-content');
            const improvementsContainer = document.getElementById('improvements-content');
            
            // Display strengths
            strengthsContainer.innerHTML = analysis.strengths.map(strength => `
                <div class="suggestion-item">
                    <div class="suggestion-title">${strength.title}</div>
                    <div>${strength.content}</div>
                </div>
            `).join('');
            
            // Display improvements
            improvementsContainer.innerHTML = analysis.improvements.map(improvement => `
                <div class="suggestion-item">
                    <div class="suggestion-title">${improvement.title}</div>
                    <div>${improvement.content}</div>
                </div>
            `).join('');
            
            // Show the feedback summary
            document.getElementById('feedback-summary').style.display = 'block';
            document.getElementById('next-btn').style.display = 'none';
        }

        function startFocusedPractice() {
    // Identify weak areas (less than 50% performance)
    const weakBlooms = Object.keys(bloomPoints).filter(bloom => 
        (bloomPoints[bloom] / maxBloomPoints[bloom]) < 0.5 && maxBloomPoints[bloom] > 0
    );
    
    const weakCompetencies = Object.keys(competencyPoints).filter(comp => 
        (competencyPoints[comp] / maxCompetencyPoints[comp]) < 0.5
    );
    
    // Build focused question set
    focusedQuestions = [];
    
    // Add questions from weak Bloom levels
    weakBlooms.forEach(bloom => {
        if (questionPools[bloom]) {
            focusedQuestions.push(...questionPools[bloom]);
        }
    });
    
    // If no focused questions, use original weak questions
    if (focusedQuestions.length === 0) {
        // Fallback: use questions from original quiz that target weak areas
        questions.forEach(q => {
            if (weakBlooms.includes(q.bloom) || weakCompetencies.includes(q.competency)) {
                focusedQuestions.push(q);
            }
        });
    }
    
    // Start focused practice mode
    isFocusedPractice = true;
    currentQuestionIndex = 0;
   // UI prep
  document.getElementById('feedback-summary').style.display = 'none';
  document.getElementById('next-btn').style.display = 'block';
  document.getElementById('next-btn').textContent = 'Next Question';

  // ‚úÖ NEW: set the denominator to the focused set size *before* updating progress
  document.getElementById('total-count').textContent = focusedQuestions.length;

  // Keep progress ring/stars in sync right away (optional but nice)
  updateProgressBars();        // if you track per-Bloom/competency bars
  updateOverallProgress();     // now uses the correct denominator

  // Render the first focused question (and your existing handler binding)
  displayQuestion();
}
        
        function restartQuiz() {
    // Reset all variables
    currentQuestionIndex = 0;
    totalCorrect = 0;
    questionsCompleted = 0;

    // Reset points
    Object.keys(bloomPoints).forEach(key => bloomPoints[key] = 0);
    Object.keys(competencyPoints).forEach(key => competencyPoints[key] = 0);

    // Reset mode to main quiz
    isFocusedPractice = false;
    focusedQuestions = [];

    // NEW: ensure total question count is correct for main quiz
    document.getElementById('total-count').textContent = questions.length;

    // Reset UI
    document.getElementById('feedback-summary').style.display = 'none';
    document.getElementById('next-btn').style.display = 'block';
    document.getElementById('next-btn').textContent = 'Next Question';

    // Update displays
    updateProgressBars();
    updateOverallProgress();
    displayQuestion();

    // Update point displays
    Object.keys(bloomPoints).forEach(bloom => {
        document.getElementById(`${bloom.toLowerCase()}-points`).textContent = '0';
    });
    Object.keys(competencyPoints).forEach(comp => {
        document.getElementById(`competency-${comp}`).textContent = '0';
    });
}
        
        function showDetailedAnalysis() {
            alert('Detailed Analysis Feature:\n\nIn a full implementation, this would show:\n‚Ä¢ Specific question performance\n‚Ä¢ Recommended study materials\n‚Ä¢ Links to relevant resources\n‚Ä¢ Progress tracking over time\n‚Ä¢ Personalized learning paths\n');
        }

        // Initialize the quiz
        displayQuestion();
        updateProgressBars();
        updateOverallProgress();
    </script>

    <script data-goatcounter="https://dr-kat-wehr.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>

</body>
</html>
